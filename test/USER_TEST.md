| ID       | Tiêu đề                                                                    | Yêu cầu dữ liệu đầu vào                                                                                                      | Dữ liệu phải có trước (Pre-condition)                                                                                                                   | Kết quả mong đợi                                                                                                                                                                                              | Số lượng Test (ít nhất) | Loại Test        | Ghi chú |
| -------- | -------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------- | ---------------- | ------- |
| USER_004 | Lấy thông tin người dùng khi tài khoản bị Ban                              | JWT hợp lệ của User B                                                                                                        | User B có Status = "Banned", DeletedAt = null                                                                                                           | Response 200 OK. Trả về UserResponse với Status = "Banned". Các trường thông tin khác vẫn hiển thị đầy đủ.                                                                                                    | 1                       | Unit Test        | Đã sửa logic: Banned user được phép xem profile |
| USER_035 | Kiểm tra middleware chặn request khi tài khoản bị Ban                      | 1\. User A đăng nhập, lấy JWT. 2. Admin ban User A (set Status = "Banned"). 3. User A thử gọi GET /api/v1/User/me với JWT cũ | User A có Status = "Active" lúc đầu. Sau đó Status = "Banned"                                                                                           | Bước 3: Response 200 OK. JSON trả về có trường Status = "Banned". Frontend sẽ tự xử lý logout dựa trên status này.                                                                                            | 1                       | Integration Test | Đã sửa logic: Middleware không chặn GET /me của banned user |
| USER_051 | Verify UserResponse chứa danh sách Permissions                             | User A có Role "Staff" chứa Permission "User.Read"                                                                           | User A đã đăng nhập                                                                                                                                     | Response 200 OK. UserResponse.Permissions là mảng chứa "User.Read".                                                                                                                                           | 1                       | Unit Test        | New     |
| USER_052 | Verify UserResponse.Permissions rỗng khi user không có quyền               | User B không có Role nào hoặc Role rỗng                                                                                      | User B đã đăng nhập                                                                                                                                     | Response 200 OK. UserResponse.Permissions là mảng rỗng hoặc null.                                                                                                                                             | 1                       | Unit Test        | New     |
| USER_053 | Integration Test: Structure của Permissions trong JSON response            | GET /api/v1/User/me                                                                                                          | User A có quyền.                                                                                                                                        | Response 200 OK. JSON có structure: `permissions: ["Permission.One", "Permission.Two"]`                                                                                                                       | 1                       | Integration Test | New     |
| USER_054 | Verify Status field cho Active user                                        | GET /api/v1/User/me                                                                                                          | User A có Status = "Active"                                                                                                                             | Response 200 OK. JSON có `"status": "Active"`                                                                                                                                                                 | 1                       | Integration Test | New     |
| USER_055 | Verify Status field cho Banned user                                        | GET /api/v1/User/me                                                                                                          | User B có Status = "Banned"                                                                                                                             | Response 200 OK. JSON có `"status": "Banned"`                                                                                                                                                                 | 1                       | Integration Test | New     |
| USER_056 | SSE Hybrid: Request không có Accept header text/event-stream               | GET /api/v1/User/me (Accept: application/json)                                                                               | User A active                                                                                                                                           | Response 200 OK. Content-Type: application/json. Kết nối đóng ngay sau khi trả dữ liệu.                                                                                                                       | 1                       | Integration Test | New     |
| USER_057 | SSE Hybrid: Request có Accept header text/event-stream                     | GET /api/v1/User/me (Accept: text/event-stream)                                                                              | User A active                                                                                                                                           | Response 200 OK. Content-Type: text/event-stream. Kết nối giữ mở (streaming).                                                                                                                                 | 1                       | Integration Test | New     |
| USER_058 | SSE: Nhận dữ liệu init ngay khi kết nối                                    | Connect SSE tới /api/v1/User/me                                                                                              | User A active                                                                                                                                           | Nhận ngay event `data` chứa JSON thông tin user hiện tại.                                                                                                                                                     | 1                       | Integration Test | New     |
| USER_059 | SSE Push: Update profile triggers notification                             | 1. User A connect SSE. 2. User A gọi PUT update FullName="New"                                                               | User A active                                                                                                                                           | SSE stream nhận event mới chứa data với FullName="New".                                                                                                                                                       | 1                       | Integration Test | New     |
| USER_060 | SSE Push: Assign roles triggers notification                               | 1. User A connect SSE. 2. Admin assign Role Manager cho User A                                                               | User A active                                                                                                                                           | SSE stream nhận event mới chứa data với Permissions mới (bao gồm quyền của Manager).                                                                                                                          | 1                       | Integration Test | New     |
| USER_061 | SSE Push: Ban user triggers notification                                   | 1. User A connect SSE. 2. Admin ban User A                                                                                   | User A active                                                                                                                                           | SSE stream nhận event mới chứa data với `"status": "Banned"`.                                                                                                                                                 | 1                       | Integration Test | New     |
| USER_062 | SSE Memory: Reconnect cleans up old connection                             | 1. Connect SSE (Conn1). 2. Disconnect Conn1 (F5). 3. Connect SSE (Conn2).                                                    | User A                                                                                                                                                      | Server log/internal state xác nhận Conn1 đã được remove khỏi danh sách listener.                                                                                                                              | 1                       | Integration Test | New     |
| USER_063 | Unit Test: UserStreamService cleanup logic                                 | Simulate cancellation token trigger                                                                                          | UserStreamService có 1 listener                                                                                                                                         | Verify method RemoveListener xóa TaskCompletionSource và xóa entry trong ConcurrentDictionary nếu list rỗng.                                                                                                  | 1                       | Unit Test        | New     |
| USER_064 | SSE: Support multiple tabs (connections)                                   | 1. Tab 1 connect SSE. 2. Tab 2 connect SSE. 3. Update profile.                                                               | User A                                                                                                                                                      | Cả Tab 1 và Tab 2 đều nhận được event update.                                                                                                                                                                 | 1                       | Integration Test | New     |
| USER_065 | SSE: Close one tab does not affect others                                  | 1. Tab 1 connect. 2. Tab 2 connect. 3. Close Tab 1. 4. Update profile.                                                       | User A                                                                                                                                                      | Tab 2 vẫn nhận được event update.                                                                                                                                                                             | 1                       | Integration Test | New     |
| USER_066 | SSE Isolation: Cross-user update safety                                    | 1. User A connect. 2. User B connect. 3. Update User A.                                                                      | User A, User B                                                                                                                                          | Chỉ SSE của User A nhận event. SSE của User B KHÔNG nhận event (không lầm sang tài khoản khác).                                                                                                               | 1                       | Integration Test | New     |
| USER_067 | SSE Isolation: Ban User B does not affect User A                           | 1. User A connect. 2. Ban User B.                                                                                            | User A active, User B active                                                                                                                            | SSE của User A KHÔNG nhận bất kỳ event nào liên quan đến việc ban User B.                                                                                                                                     | 1                       | Integration Test | New     |
| USER_068 | SSE Isolation: JWT context separation                                      | User A dùng JWT của A để connect SSE. Thử dùng JWT B để trigger update A (giả lập attack)                                    | User A, User B                                                                                                                                          | Request update bị chặn (403/401) hoặc nếu update thành công cho B thì A không nhận được gì.                                                                                                                   | 1                       | Integration Test | New     |
| USER_069 | SSE Error: User deleted triggers error event                               | 1. User A connect SSE. 2. Admin soft delete User A.                                                                          | User A active                                                                                                                                           | SSE stream nhận event type `error` chứa message "Account has been deleted" hoặc tương tự.                                                                                                                     | 1                       | Integration Test | New     |
| USER_070 | SSE Timeout: Connection gracefully closed                                  | Connect SSE và idle quá thời gian timeout (nếu có config)                                                                    | User A                                                                                                                                                      | Connection đóng gracefully, client có thể reconnect.                                                                                                                                                          | 1                       | Integration Test | New     |
